<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ERANGA - Beranda</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/heroicons/2.0.13/24/outline/heroicons.min.css" rel="stylesheet">
  <?!= include('style'); ?>
</head>
<body class="antialiased text-gray-800 min-h-screen">

  <div id="camera-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md text-center p-4 sm:p-6 space-y-4">
      <h3 class="text-lg font-bold text-gray-800">Verifikasi Selfie</h3>
      <div class="relative w-full aspect-square bg-gray-200 rounded-md overflow-hidden flex items-center justify-center">
        <video id="camera-preview" class="w-full h-full object-cover" autoplay playsinline></video>
        <div id="camera-loading" class="absolute text-gray-600">Memulai kamera...</div>
      </div>
      <canvas id="camera-canvas" class="hidden"></canvas>
      <div class="flex flex-col sm:flex-row gap-4">
        <button id="capture-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition flex items-center justify-center space-x-2">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" /><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" /></svg>
          <span>Ambil Foto</span>
        </button>
        <button onclick="closeCameraModal()" class="w-full bg-gray-200 text-gray-800 font-bold py-3 px-4 rounded-lg hover:bg-gray-300 transition">
          Batal
        </button>
      </div>
    </div>
  </div>
  
  <div id="absence-choice-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-sm text-center p-6 space-y-6">
      <h3 class="text-xl font-bold text-gray-800">Pilih Keterangan Tidak Hadir</h3>
      <div class="flex flex-col gap-4">
        <button onclick="processAbsenceChoice('Izin')" class="w-full bg-gray-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-600 transition flex items-center justify-center space-x-2 text-base">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
          </svg>
          <span>Izin</span>
        </button>
        <button onclick="processAbsenceChoice('Sakit')" class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition flex items-center justify-center space-x-2 text-base">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
          </svg>
          <span>Sakit</span>
        </button>
        <button onclick="closeAbsenceChoiceModal()" class="w-full bg-white text-gray-800 font-bold py-3 px-4 rounded-lg hover:bg-gray-200 transition border border-gray-300">
          Batal
        </button>
      </div>
    </div>
  </div>

  <div class="container mx-auto p-4 md:p-6 max-w-lg">
    <header class="text-center mb-6">
      <div class="bg-white p-5 rounded-full shadow-md w-32 h-32 mx-auto flex items-center justify-center mb-4 border border-gray-200">
      <img src="https://raw.githubusercontent.com/FebraS/ERANGA/refs/heads/main/assets/ERANGA_LOGO.png" alt="ERANGA Logo" class="w-24 h-20">
      </div>
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">ERANGA - Elektronik Rekam Absensi Nyaman, Gampang, & Akurat</h1>
      <p id="current-time" class="text-gray-600 mt-2 text-sm md:text-base">Memuat waktu...</p>
    </header>

    <main id="app-container">
      <div id="login-view" class="bg-white p-6 sm:p-8 rounded-2xl shadow-md border border-gray-200 space-y-6">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-4">Selamat Datang</h2>
        
        <div>
          <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
              </svg>
            </div>
            <input type="text" id="username" class="block w-full pl-10 pr-3 py-2.5 bg-gray-50 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-gray-900">
          </div>
        </div>

        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
          <div class="relative">
             <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
                </svg>
             </div>
            <input type="password" id="password" class="block w-full pl-10 pr-10 py-2.5 bg-gray-50 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-gray-900">
            <button type="button" id="toggle-password-btn" class="absolute inset-y-0 right-0 flex items-center pr-3">
              <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.432 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <svg id="eye-slash-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400 hidden">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243L6.228 6.228" />
              </svg>
            </button>
          </div>
        </div>
        
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                <label for="remember-me" class="ml-2 block text-sm text-gray-700">
                    Ingat Saya
                </label>
            </div>
        </div>
        
        <button id="login-button" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition">
          Login
        </button>
        <div id="login-status" class="text-center text-sm font-medium text-red-600 min-h-[20px]"></div>
      </div>

      <div id="main-content" class="hidden space-y-4 md:space-y-6"> 
        <div id="user-card" class="bg-white p-6 sm:p-8 rounded-2xl shadow-md border border-gray-200"> 
          <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-3">Profil Pengguna</h2>
          <div class="space-y-3 text-sm">
            <div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg><span class="font-medium text-gray-500 w-20">Nama</span><span id="user-name" class="text-gray-900 font-semibold">...</span></div>
            <div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" /></svg><span class="font-medium text-gray-500 w-20">NUPTK</span><span id="user-nuptk" class="text-gray-900">...</span></div>
            <div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.5 3a2.5 2.5 0 00-2.121 4.121l-.628.627a.5.5 0 00.707.707l.628-.627A2.5 2.5 0 105.5 3zm9 0a2.5 2.5 0 00-2.121 4.121l-.628.627a.5.5 0 00.707.707l.628-.627A2.5 2.5 0 1014.5 3zM4 10a.5.5 0 00-.707.707l.627.628A2.5 2.5 0 107 10.5H4z" clip-rule="evenodd" /><path d="M10 3a.5.5 0 00-.707.707l.627.628A2.5 2.5 0 1013 5.5h-3a.5.5 0 000 1h3a2.5 2.5 0 10-2.121-4.121L10.707 3.707A.5.5 0 0010 3zM7 13.5a.5.5 0 000 1h3a2.5 2.5 0 102.121-4.121l.627-.628a.5.5 0 00-.707-.707l-.627.628A2.5 2.5 0 107 13.5z" /></svg><span class="font-medium text-gray-500 w-20">Gender</span><span id="user-gender" class="text-gray-900">...</span></div>
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2H6zm1 2a1 1 0 000 2h6a1 1 0 100-2H7zm0 4a1 1 0 000 2h6a1 1 0 100-2H7zm0 4a1 1 0 000 2h4a1 1 0 100-2H7z" clip-rule="evenodd" />
              </svg>
              <span class="font-medium text-gray-500 w-20">Jabatan</span>
              <span id="user-jabatan" class="text-gray-900">...</span>
            </div>
          </div>
          <button id="logout-button" class="w-full mt-6 bg-red-600 text-white font-bold py-2.5 px-4 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition flex items-center justify-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
            </svg>
            <span>Logout</span>
          </button>
        </div>

        <div id="status-card" class="bg-white p-6 sm:p-8 rounded-2xl shadow-md border border-gray-200"> 
          <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-3">Status Absensi Hari Ini</h2>
          <div class="space-y-3 text-base">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l.293.293a1 1 0 001.414-1.414l-3-3z" clip-rule="evenodd" /></svg>
                <span class="font-medium text-gray-700">Absen Masuk</span>
              </div>
              <span id="status-masuk" class="font-bold text-gray-600 bg-gray-100 px-3 py-1.5 rounded-full text-sm">Belum Absen</span>
            </div>
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-orange-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-.707-4.707a1 1 0 001.414 1.414l3-3a1 1 0 00-1.414-1.414L11 10.586V7a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3z" clip-rule="evenodd" /></svg>
                <span class="font-medium text-gray-700">Absen Keluar</span>
              </div>
              <span id="status-keluar" class="font-bold text-gray-600 bg-gray-100 px-3 py-1.5 rounded-full text-sm">Belum Absen</span>
            </div>
          </div>
        </div>

        <div id="action-card" class="bg-white p-6 sm:p-8 rounded-2xl shadow-md border border-gray-200"> 
          <h2 class="text-xl font-semibold text-center text-gray-800 mb-6">Silakan Lakukan Absensi</h2>
          <div class="grid grid-cols-1 gap-4">
            <button id="btn-masuk" onclick="handleAttendance('Masuk')" class="w-full bg-blue-600 text-white font-bold py-3.5 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition flex items-center justify-center space-x-2 text-base"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" /></svg><span>Absen Masuk</span></button>
            <button id="btn-keluar" onclick="handleAttendance('Keluar')" class="w-full bg-orange-500 text-white font-bold py-3.5 px-4 rounded-lg hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-400 transition flex items-center justify-center space-x-2 text-base"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M9 9l3 3m0 0l3-3m-3 3v6" /></svg><span>Absen Keluar</span></button>
            <button id="btn-tidak-hadir" onclick="openAbsenceChoiceModal()" class="w-full bg-red-600 text-white font-bold py-3.5 px-4 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition flex items-center justify-center space-x-2 text-base">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
              </svg>
              <span>Isi Keterangan Tidak Hadir</span>
            </button>
          </div>
        </div>
        
        <div id="message-area" class="opacity-0 message-card mt-6"></div>
      </div>
    </main>
    
    <footer class="text-center mt-8 text-xs text-gray-500">
      <p>&copy; 2025 - ERANGA. Hak Cipta Dilindungi.</p> 
    </footer>
  </div>

<?!= include('javascript'); ?>

</body>
</html>
